---
title: "hw02-gapminder exploration"
author: "Frederike Basedow"
date: "22 September 2018"
output: github_document
---

### Load the data and packages
```{r, message=FALSE}
library(gapminder)
library(tidyverse)
library(knitr)
```

### Smell test the data

_Explore the gapminder object:_

__1. Is it a data.frame, a matrix, a vector, a list?__

```{r}
# Check for the structure and type of gapminder
str(gapminder)
typeof(gapminder)
```

Gapminder is a list that contains 3 different classes: table-data frame, table and data frame. 

__2. What is its class?__

```{r}
class(gapminder)
```

__3. How many variables/columns?__

```{r}
n_var <- ncol(gapminder)
n_var
```

Gapminder has `r n_var` variables.

__4. How many rows/observations?__

```{r}
n_obs <- nrow(gapminder)
n_obs
```

Gapminder has `r n_obs` observations.

__5. Can you get these facts about “extent” or “size” in more than one way? Can you imagine different functions being useful in different contexts?__

Another way to get the number of rows and columns is to use the `dim()` function:
```{r}
dim(gapminder)
```

Furthermore, the output of the `str()` function also includes the dimensions of the object in its first line. `str()` is useful if you just want to get an overview of what the dimension are but not do anything with them. `dim()`, `nrow()` and `ncol()` are useful if you want to use the output numbers for future calculations. For example, you might want to use the total number of observations to calculate the mean. Here is an example for calculating the mean gdpPercap, making use of `n_obs` as assigned above:

```{r}
sum(gapminder$gdpPercap)/n_obs
```

__6. What data type is each variable?__

```{r}
sapply(gapminder, class) # using the sapply() function which returns a vector that is the same length as gapminder, i.e. applying it to each variable.
```

The first row shows the variable and the second row the respective type of each variable.

### Explore individual variables

_Pick at least one categorical variable and at least one quantitative variable to explore._

I will explore `country` and `year` as categorical variables and `lifeExp` and `gdpPercap as quanititative variables.

__1. What are possible values (or range, whichever is appropriate) of each variable?__

I will safe the output of each of these calculations in case I will need them later.
```{r}
r_lE <- range(gapminder$lifeExp) # get the lowest and highest value of lifeExp
r_lE

n_ct <- nlevels(gapminder$country) # get the number of countries
n_ct

all_ct <- levels(gapminder$country) # get a list of each country in the data set
all_ct

all_ys <- levels(as.factor(gapminder$year)) # get a list of all years included in data set
all_ys

r_gdp <- range(gapminder$gdpPercap) # get the lowest and highest value of gdpPercap
r_gdp
```

__2. What values are typical? What’s the spread? What’s the distribution? Etc., tailored to the variable at hand.__

Here are some details for the lifeExp variable. I am going to get some statistics of the variable and will show it's distribution with a density plot.

```{r}
# get statistics of lifeExp variable, make them into a data frame for presenting in nice table with kable()
summary(gapminder$lifeExp) %>% as.matrix() %>% as.data.frame() %>% rownames_to_column() %>% rename(Stat=rowname, Value=V1) %>% kable()

# make density plot for lifeExp variable
gapminder %>% 
  ggplot(aes(lifeExp)) + 
  geom_density() +
  labs(x="Life Expectancy", y="Density")
```

Next I am going to show how many countries there are per continent in first year of data collection, i.e. 1952. To make sure that the same number of countries is included in 1952 as in the whole data set, I will check if the number compares to the total number that I 

```{r}
gm_fy <- gapminder %>% filter(year == 1952) # filter gapminder for year 1952

n_ct_fy <- nlevels(gm_fy$country) # calculate number of countries recorded in 1952

n_ct_fy == n_ct # check if number of countries in first year is the same as number of countries as calculate earlier with all levels of the country variable

# make bar graph of number of countries per continent with filtered data from above
gm_fy %>% 
  ggplot(aes(continent)) +
  geom_bar()
```


Next, I am going to do the same for gdpPercap.

```{r}
# get statistics of gdpPercap variable, make them into a data frame for presenting in nice table with kable()
summary(gapminder$gdpPercap) %>% as.matrix() %>% as.data.frame() %>% rownames_to_column() %>% rename(Stat=rowname, Value=V1) %>% kable()

# make density plot for lifeExp variable, I will use a log scale for this variable
gapminder %>% 
  ggplot(aes(gdpPercap)) + 
  scale_x_log10() +
  geom_density() +
  labs(x="GDP per capita", y="Density")
```

To get a better idea of how life expectancy differs between different countries per continent and how it changed throughout the years, here is a plot that gives an overview of the life expectancy over the years per country, coloured by continent:

```{r}
# make plot that shows lifeExp over the years per country with colour coding per continent
gapminder %>% 
  ggplot(aes(year,lifeExp)) +
  geom_line(aes(group=country, colour=continent)) +
  labs(x="Year", y="Life Expectancy")
```

Here is the same for the GDP, on a log scale:
```{r}
# make plot that shows lifeExp over the years per country with colour coding per continent
gapminder %>% 
  ggplot(aes(year,gdpPercap)) +
  scale_y_log10() +
  geom_line(aes(group=country, colour=continent)) +
  labs(x="Year", y="GDP per capita")
```


### Explore various plot types

Make a few plots, probably of the same variable you chose to characterize numerically. You can use the plot types we went over in class (cm006) to get an idea of what you’d like to make. Try to explore more than one plot type. Just as an example of what I mean:

1. A scatterplot of two quantitative variables.

```{r}
# make a scatterplot of lifeExp vs. gdpPercap
gapminder %>% 
  ggplot(aes(gdpPercap, lifeExp)) + 
  scale_x_log10() +
  geom_jitter() 
```

2. A plot of one quantitative variable. Maybe a histogram or densityplot or frequency polygon.

```{r}
# frequency pplygon for population, put on log scale!
gapminder %>% 
  ggplot(aes(pop)) +
  scale_x_log10() +
  geom_freqpoly()
```

3. A plot of one quantitative variable and one categorical. Maybe boxplots for several continents or countries.

```{r}
gapminder %>% 
  ggplot(aes(continent, lifeExp)) +
  geom_violin() +
  geom_jitter(alpha=0.25) +
  labs(x="Continent", y="Life Expectancy")
```


You don’t have to use all the data in every plot! It’s fine to filter down to one country or small handful of countries.

```{r}
gapminder %>% filter(continent == "Asia") %>% 
  ggplot(aes(country, lifeExp)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```


### Use filter(), select() and %>%

1. Use filter() to create data subsets that you want to plot. Practice piping together filter() and select(). Possibly even piping into ggplot().

```{r}
# i don't understand the use of `select()` when you're plotting data since you're selecting data in your plot settings anyways
gapminder %>% 
  select(continent, country, lifeExp, year) %>% 
  filter(year=="1952") %>% 
  ggplot(aes(continent, lifeExp)) +
  geom_violin() +
  geom_jitter()
```

### But I want to do more!

Evaluate this code and describe the result. Presumably the analyst’s intent was to get the data for Rwanda and Afghanistan. Did they succeed? Why or why not? If not, what is the correct way to do this?

```{r}
filter(gapminder, country == c("Rwanda", "Afghanistan"))
```

They did not succeed - the output doesn't include all of the data of Afghanistan and Rwanda, only one of the two for each year. 

The correct way is:
```{r}
gapminder %>% filter(country %in% c("Afghanistan", "Rwanda"))

# or

gapminder %>% filter(country == "Afghanistan" | country =="Rwanda")
```


